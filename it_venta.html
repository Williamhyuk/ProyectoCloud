<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase CRUD</title>

  <!-- BOOTSWATCH -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/pulse/bootstrap.min.css">

  <!-- ANIMATE CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css" />


  <link rel="stylesheet" type="text/css" href="estilo.css">

</head>

<body class="bg-light">



  <!-- ADD TASK -->
  <div class="container p-4">
    <div class="row">
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">

            <h1 class="h4" style="text-align: center;">PUBLICA TU LIBRO</h1>

            <form id="task-form">
                
                <div>
                    <h6>Suba una imagen para la portada:</h6>
                </div>
                <button id="select">Seleccionar imagen</button>
                <div>
                    <h6> </h6>
                </div>
                <style>img{height: 200px; width: 200px; border: 2px black;}</style>
                <!-- 
                <input id="namebox" type="text"> <br> <br> -->
                
            	
                <img id="myimg"> <label id="UpProgress"></label> <br> <br>



                <div class="form-group">
                    <input type="text" id="task-title" class="form-control" class="Task Title" placeholder="Título"
                    autofocus required>
                </div>
                <div class="form-group">
                    <textarea id="task-description" rows="3" class="form-control" placeholder="Descripción" required></textarea>
                </div>

                <div class="form-group">
                    <input type="number" id="task-price" class="form-control" class="Task Price" placeholder="Precio"
                    autofocus required>
                </div>
                <div class="form-group">
                    <input type="number" id="task-cant" class="form-control" class="Task Cant" placeholder="Número de unidades"
                    autofocus required>
                </div>


                

                
                
                <!-- <button id="retrieve">Visualizar</button> -->

                <div>
                    <h6>   </h6>
                </div>

                <div>
                <h6>   </h6>
            </div>

            <div>
                <h6>Mostraremos una aproximación de tu ubicación para ayudar a los compradores cercanos a verla y así aumentar tus posibilidades de venta:</h6>
            </div>
            
            <!--    
            <div id="map"></div>
			<script src="script.js"></script>
			<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCrmCVYLrQnozRu7Bafy8Na1Vog1isqA30&callback=iniciarMap"></script>
			-->


			<div class="container">
	        <div class="row justify-content-center">
	            <div class="col-md-8 col-md-offset-2" align="center">
	                <div style="text-align: left;margin-top: 30px;">
	                    <b>Latitud: </b><span id="latitude"></span><br>
	                    <b>Longitud: </b><span id="longitude"></span><br>
	                </div>
	                	<div id="map">
	                    	<iframe frameborder="0" style="border:0; width: 100%;height:300px;" src="" ></iframe>
	                	</div>
	            	</div>
	        	</div>
	    	</div>

	    	<script
	            src="https://code.jquery.com/jquery-3.4.1.min.js"
	            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
	            crossorigin="anonymous"></script>
	    	<script>
	        $(document).ready(function () {
	            if ("geolocation" in navigator) {
	                navigator.geolocation.getCurrentPosition(function (p) {
	                    showUserDetails(p.coords.latitude, p.coords.longitude);
	                }, function (e) {
	                    ipLookup();
	                });
	            } else
	                ipLookup();
	        });

        function showUserDetails(latitude, longitude, additional) {
            var position = latitude + "," + longitude;

            $("#latitude").text(latitude);
            $("#longitude").text(longitude);

            var url = "https://www.google.com/maps/embed/v1/view?center="+position+"&zoom=12&key=AIzaSyCrmCVYLrQnozRu7Bafy8Na1Vog1isqA30";
            $("iframe").attr('src', url);
        }

        function ipLookup() {
            $.get('https://api.userinfo.io/userinfos', function (r) {
               showUserDetails(r.position.latitude, r.position.longitude, r);
            });
        }
    </script>

				<!-- <select class="custom-select" id="task-cat">
				<option selected>Categoría principal</option>
				<option value="1">Tecnología</option>
				<option value="2">Infantil</option>
				<option value="3">Misterio</option>
				<option value="3">Suspenso</option>
				</select> -->


				<button class="btn btn-primary" id="btn-task-form">Publicar</button>
				


                <script id="MainScript">
					var ImgName, ImgUrl;
					var files = [];
					var reader;



					document.getElementById("select").onclick=function(e){
						var input = document.createElement('input');
						input.type = 'file';
						input.onchange = e => {
							files = e.target.files;
							reader = new FileReader();
							reader.onload = function(){
								document.getElementById("myimg").src = reader.result;
							}
							reader.readAsDataURL(files[0]);
						}
						input.click();
					}

					

					document.getElementById("btn-task-form").onclick = function(){
						ImgName = document.getElementById('task-title').value;
						var uploadTask = firebase.storage().ref('Images/'+ImgName+".jpg").put(files[0]);
						uploadTask.on('state_changed',function(snapshot){
							var progress = (snapshot.bytesTransferred / snapshot.totalBytes)*100;
							document.getElementById('UpProgress').innerHTML = 'Progreso: '+progress+'%';
						},

						function(error) {
							alert('Hubo un error con la imagen de la portada.');
						},

						function(){
							uploadTask.snapshot.ref.getDownloadURL().then(function(url){
								ImgUrl = url;

								firebase.database().ref('Pictures/'+ImgName).set({
									Name: ImgName,
									Link:ImgUrl
								});
							alert('La imagen de la portada fue cargada correctamente.');
							}
							);
						});
					}

					
					  

					/*document.getElementById('retrieve').onclick = function(){
						ImgName = document.getElementById('namebox').value;
						firebase.database().ref('Pictures/'+ImgName).on('value',function(snapshot){
							document.getElementById('myimg').src = snapshot.val().Link;
						});
					}*/

				</script>



			
              	
            </form>




           


          </div>
        </div>
      </div>
      <!-- Tasks List -->
      <div class="col-md-6" id="tasks-container"></div>
    </div>
  </div>




















  <!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script> -->

  <!-- FIREBASE -->
  <!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/8.2.5/firebase.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.2.5/firebase-storage.js"></script>
	<!-- TODO: Add SDKs for Firebase products that you want to use
	     https://firebase.google.com/docs/web/setup#available-libraries -->
	<script src="https://www.gstatic.com/firebasejs/8.2.5/firebase-firestore.js"></script>
	<script>
	  // Your web app's Firebase configuration
	  var firebaseConfig = {
	    apiKey: "AIzaSyDMZY3ogoVcOcXZsP5yj4MulZEXjChFumM",
	    authDomain: "fbproyecto-c4c36.firebaseapp.com",
	    databaseURL: "https://fbproyecto-c4c36-default-rtdb.firebaseio.com",
	    projectId: "fbproyecto-c4c36",
	    storageBucket: "fbproyecto-c4c36.appspot.com",
	    messagingSenderId: "444312263936",
	    appId: "1:444312263936:web:68402c8d4f72bcc79267e5"
	  };
	  // Initialize Firebase
	  firebase.initializeApp(firebaseConfig);
	</script>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  
  <!-- CUSTOM CODE -->
  <script src="it_venta.js"></script>
</body>

</html>

